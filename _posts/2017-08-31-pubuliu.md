---
layout: default
title: js实现动态瀑布流
---

<h2>{{ page.title }}</h2>
<p class="siamess-left">这里简单介绍一下瀑布流的实现</p>
<p class="important">瀑布流就是瀑布一样的水流，好的，介绍完毕。说实话，为什么要做瀑布流哦，难道不知道会给人一种很杂乱的感觉吗。用户会觉得你提供的信息是么有进行分类处理的好不好？规规矩矩的实现不好吗？anyway，bite me .</p>
<p class="siamess-left">移动端瀑布流的原理</p>
<p>移动端一般会分2栏布局，然后一次顺序加载。其实实现的原理就是不论我们有多少的数据，填充进了模板里面之后，全部获取到这些模板，并且全部进行重新定位。父元素，也就是包裹这些单个div的元素，设置宽度适应容器的外部宽度。也就是position:relative;width:100%;单个的元素，也就是你全部的模板设置为position:absolute;进行根据父元素绝对定位。</p>
<br>
<br>
<p class="important">不bb，直接上代码。</p>
<p>div.wrap > div.wrapImg > img 。 最外层的wrap的设置就是父元素的设置。wrapImg的设置就是绝对定位的设置，同时设置宽度，最小高度，这个都是自己定的。img的高度和宽度你可以设置为自适应。 接下来就是js处理的步骤，也是最关键的步骤。首先设置一个数组var colHeight = [0,0];用于存放和比较两个容器的高度，获取所有的wrapImg并且进行遍历， $('.wrapImg').each(function(){})。在这个遍历的过程里，首先，比较
colHeight[0]和colHeight[1]的大小，因为数组里存的是当前两个列谁更大，我们要做的是获取到当前比较小的一列，并且把当前的元素给定位到比较小的一列里去。获取到当前比较小的高度之后，我们还要获取当前比较小的一列的下标，然后进行绝对定位，把元素的top设置为比较小的一列的值，而当下标为0 的时候，就是设置到左边一列，下表为1的时候就是设置到右边一列。具体的实现是 left: index * window.width() *0.5
</p>
<p>然后就是日常的取数据，当然你需要把当前列的高度更新一下，最后把这个方法封装一下，在页面进行滚动的时候触发，或者直接写定时器不停的进行布局。</p>
<img src="/img/pubuliu.png" style="width:100%;height:100%;" />
<p class="siamess-left">pc端的瀑布流</p>
<p>pc端的瀑布流和手机端的大体是一致的实现思路，唯一的区别在于pc端的栏目，也就是分几栏是不固定的，所以需要动态的去计算，但是记住一点，你图片的容器的宽度是固定的，不然你也无法进行计算。</p>
<p>思路： 通过当前的屏幕宽度除以容器的宽度，获取到当前有多少列容器，那么创建的数组的长度就是列的数量，数组是为了保存现在全部列的高度的。获取到你定义的元素容器，遍历容器数组，在遍历下表小于数组长度的时候，直接把元素的高度push进数组里面去，相当于只是把window放了一排的数据进去。在遍历下表大于数组长度的时候，说明现在已经到了第二行或者更多的了，那么就需要进行比较当前高度最小的一列，这里比较的是数组里面最小的一个，并且获取到数据和下标。再通过绝对定位把元素定位到对应的最小列的最下面，最后把当前列的高度给更新一下就可以了，下面贴上代码。</p>
<img src="/img/pubuliu2.png" style="width: 100%;height: 100%;"/>
<p>{{ page.date | date_to_string }}</p>